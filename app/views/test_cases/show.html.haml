= render partial: "projects/menu", locals: {project: @test_case.test_suite.test_run.project}
= render partial: "breadcrumb", locals: {test_case: @test_case}

.panel.panel-primary
  .panel-heading
    %span{ :class => "label label-#{status_map(@test_case.status)}"}= @test_case.status
    =@test_case.name
  .panel-body
    %table.table.table-hover
      %tr
        %th duration
        %td
          = distance_of_time_in_words @test_case.end, @test_case.start
          %span= "(#{@test_case.start.strftime('%H:%M:%S')} -> #{@test_case.end.strftime('%H:%M:%S')})"

      - @test_case.tags.each do |tag|
        %tr
          %th= tag.name
          %td= tag.value

    %button.btn.btn-primary{ :type => "button", :'data-toggle' => "collapse", :'data-target' => "#history", :'aria-expanded' => "false", :'aria-controls' => "history"} history
    .collapse#history
      .well
        %ul.list-group
          - history(@test_case).order("start DESC").each do |tc|
            = link_to tc.start, test_case_path(tc), class: "list-group-item list-group-item-#{status_map(tc.status)}"

    %ul.list-group
      - @test_case.steps.order("start").each do |step|
        %li{ :class => "list-group-item list-group-item-#{status_map(step.status)}"}
          %h4.list-group-item-heading= step.name
          %p.list-group-item-text
            "#{step.start.strftime('%H:%M:%S')} -> #{step.end.strftime('%H:%M:%S')}"
            %span.label.label-default= distance_of_time_in_words step.end, step.start
            %span.label.label-default= step.status

    - if @test_case.failure
      .well
        %h4 Message
        %p= @test_case.failure.message
        %h4 Stack Trace
        %p= @test_case.failure.stack_trace

    - if @test_case.attachments
      .row
        - @test_case.attachments.order('position').each do |a|
          .col-xs-6.col-md-3
            = link_to a.get_link, class: "thumbnail" do
              %img{ :src => a.get_link, :alt => ""}
              .caption
                %p= a.title
