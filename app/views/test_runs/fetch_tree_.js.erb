var tree = [];
<% @tree.each do |group| %>
  var g = <%= group.to_json.html_safe %>
  console.log(g);
  var ts = {
    text: g.name,
    tags: g.tags,
    color: "#000",
    backColor: "#eee",
    selectable: false,
    state: {
      expanded: false
    },
    nodes: []
  };
  <% group[:test_cases].each do |tc| %>
    var c = <%= tc.to_json.html_safe %>
    var color, backColor;
    switch (c.status) {
      case "passed":
        color = "#3c763d";
        backColor = "#dff0d8";
        break;
      case "failed":
        color = "#a94442";
        backColor = "#f2dede";
        break;
      case "broken":
        color = "#8a6d3b";
        backColor = "#fcf8e3";
        break;
      case "pending":
        color = "gray";
        backColor = "#dff0d8";
        break;
      default:
        color = "#ffffff";
        backColor = "#000000";
        break;
    }
    ts.nodes.push({
      text: c.name,
      id: c.id,
      color: color,
      backColor: backColor
    });
  <% end %>
  tree.push(ts);
<% end %>
console.log(tree);
$('#tree').treeview({data: tree, showTags: true, borderColor: "#eee"});
$('#tree').on('nodeSelected', function(event, data) {
  if (!data.hasOwnProperty('parentId')) {
    return;
  }
  return $.ajax({
    url: '/fetch_test_case',
    type: 'GET',
    data: {
      id: data.id
    },
    success: function(response) {
      return $('#coll-buttons > .btn').on('click', function(e) {
        e.preventDefault;
        return $('.coll-content').collapse('hide');
      });
    }
  });
});
